input { pipeline { address => suricata_sqloutput } }

output {
# file {
#   path => "/var/log/logstash/output.debug"
# }

#if "suricata" in [tags] {
if [event][type] == "suricata" {
if [event][subtype] == "alert" {
    jdbc {
        driver_jar_path => '/opt/sqljdbc/sqljdbc_7.2/deu/mssql-jdbc-7.2.1.jre8.jar'
        connection_string => "jdbc:sqlserver://192.168.56.28:1433;databaseName=StagingArea_v2;user=logstash;password=j#Z59UR2ssis"
        max_pool_size => '15'
	connection_timeout => '30000'
	statement => [
            "INSERT INTO [dbo].[suricata.alert]
                ([_version]
                ,[_timestamp]
                ,[alert.action]
                ,[alert.category]
                ,[alert.severity]
                ,[alert.signature]
                ,[alert.signature.id]
                ,[alert.metadata.anforderung]
                ,[dest.hostname]
                ,[dest.ip]
                ,[src.hostname]
                ,[src.ip]
                ,[log.severity]
                ,[network.origin]
                ,[vlan]
                ,[dest.geo.lat]
                ,[dest.geo.lon]
                ,[@timestamp]
                ,[customer.id]
		,[client.ip])
            VALUES
                (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, GETDATE(), 1, ?)",
                "@version",
                "@timestamp",
                "[alert][action]",
                "[alert][category]",
                "[alert][severity]",
                "[alert][signature]",
                "[alert][signature_id]",
                "[alert][metadata][anforderung]",
                "[dest_hostname]",
                "[dest_ip]",
                "[src_hostname]",
                "[src_ip]",
                "[log][severity]",
                "[network][origin]",
                "vlan",
                "[dest_geo_location][lat]",
                "[dest_geo_location][lon]",
		"[src_ip]"
        ]
    }
}

# if [event][subtype] == "flow" {
#    jdbc  {
#        driver_jar_path => '/opt/sqljdbc/sqljdbc_7.2/deu/mssql-jdbc-7.2.1.jre8.jar'
#        connection_string => "jdbc:sqlserver://192.168.56.28:1433;databaseName=StagingArea_v2;user=logstash;password=j#Z59UR2ssis"
#        statement => [
#            "INSERT INTO [dbo].[suricata.flow]
#                ([_version]
#                ,[_timestamp]
#                ,[client.hostname]
#                ,[client.ip]
#                ,[dest.hostname]
#                ,[dest.ip]
#                ,[dest.port]
#                ,[dest.port.name]
#                ,[src.hostname]
#                ,[src.ip]
#                ,[src.port]
#                ,[src.port.name]
#                ,[log.severity]
#                ,[flow.alerted]
#                ,[flow.bytes]
#                ,[flow.bytes.to_client]
#                ,[flow.bytes.to_server]
#                ,[flow.packets]
#                ,[flow.packets.to_client]
#                ,[flow.packets.to_server]
#                ,[flow.start]
#                ,[flow.end]
#                ,[flow.id]
#                ,[ip.version]
#                ,[network.origin]
#                ,[vlan]
#                ,[dest.geo.lat]
#                ,[dest.geo.lon]
#                ,[@timestamp]
#                ,[customer.id])
#            VALUES
#                (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, GETDATE(), 1)",
#                "@version",
#                "@timestamp",
#                "[client][hostname]",
#                "[src_ip]",
#                "[dest_hostname]",
#                "[dest_ip]",
#                "[dest_port]",
#                "[dest_port_name]",
#                "[src_hostname]",
#                "[src_ip]",
#                "[src_port]",
#                "[src_port_name]",
#                "[log][severity]",
#                "[flow][alerted]",
#                "[flow][bytes]",
#                "[flow][bytes_toclient]",
#                "[flow][bytes_toserver]",
#                "[flow][pkts]",
#                "[flow][pkts_toclient]",
#                "[flow][pkts_toserver]",
#                "[flow][start]",
#                "[flow][end]",
#                "flow_id",
#                "ip_version",
#                "[network][origin]",
#                "vlan",
#                "[dest_geo_location][lat]",
#                "[dest_geo_location][lon]"
#        ]
#
#jdbc
}
#Flow
}
#Filter Suricata
}
#output
}
